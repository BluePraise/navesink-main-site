---
const { title = "Ready to organize?" } = Astro.props;
---

<section class="subscribe-free-kit my-5 py-5 text-center bg-light">
	<div class="container col-md-8 mx-auto">
		<h2 class="mb-4">{title}</h2>

		<p class="col-md-6 mx-auto">
			Sign up with your email to receive our comprehensive kit that
			includes a step-by-step guide, worksheets, tips, and resources to
			help you organize your digital life effectively.
		</p>
        <p class="italic">
            We respect your privacy. Unsubscribe at any time.
        </p>

		<form id="subscribe-form" class="vstack gap-3 col-md-4">
			<input
				type="text"
				class="form-control"
				name="name"
				id="name"
				placeholder="Enter your name"
				required
			/>
			<input
				type="email"
				class="form-control"
				name="email"
				id="email"
				placeholder="Enter your email"
				required
			/>
			<div class="col-auto">
				<button type="submit" class="btn btn-primary mb-3">
					Get the Free Kit
				</button>
			</div>
			<div id="message" class="alert" style="display: none;"></div>
		</form>
	</div>
</section>

<style>
    .subscribe-free-kit form.vstack {
        margin: auto;
        padding: 20px;
    }
    .subscribe-free-kit input.form-control {
        padding: 10px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: var(--radius-md);
        width: 100%;
        box-sizing: border-box;
    }
    .subscribe-free-kit input.form-control:focus {
        border-color: var(--color-primary);
        outline: none;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }
    .italic {
        font-style: italic;
        color: gray;
        font-size: 0.9rem;
        margin-top: -10px;
        margin-bottom: 10px;
    }
    .alert {
        padding: 1rem;
        border-radius: var(--radius-md);
        margin-top: 1rem;
    }
    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
</style>

<script>
    const form = document.getElementById('subscribe-form') as HTMLFormElement;
    const messageDiv = document.getElementById('message') as HTMLDivElement;
    const submitButton = form?.querySelector('button[type="submit"]') as HTMLButtonElement;

    form?.addEventListener('submit', async (e) => {
        e.preventDefault();

        const nameInput = document.getElementById('name') as HTMLInputElement;
        const emailInput = document.getElementById('email') as HTMLInputElement;

        // Disable button and show loading state
        submitButton.disabled = true;
        submitButton.textContent = 'Subscribing...';
        messageDiv.style.display = 'none';

        try {
            const response = await fetch('/api/subscribe', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: nameInput.value,
                    email: emailInput.value
                })
            });

            const data = await response.json();

            if (response.ok) {
                // Success! Redirect to thank you page
                window.location.href = '/thank-you';
            } else {
                throw new Error(data.error || 'Subscription failed');
            }
        } catch (error) {
            console.error('Error:', error);
            messageDiv.textContent = error instanceof Error ? error.message : 'Something went wrong. Please try again.';
            messageDiv.className = 'alert alert-error';
            messageDiv.style.display = 'block';

            submitButton.disabled = false;
            submitButton.textContent = 'Get the Free Kit';
        }
    });
</script>